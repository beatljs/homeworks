
---
<img src="../../Netology.png" height="24px"/>

### Учебная группа DevOps-32

---

## Решение по домашнему заданию к занятию «Микросервисы: подходы» 

Содержание;

- [Решение задачи 1: Обеспечить  разработку](#task1) 
- [Решение задачи 2: Логи](#task2) 
- [Решение задачи 3: Мониторинг](#task3) 
- [Исполнитель](#student)


---

###### task1
### Решение задачи 1: Обеспечить разработку


<details>
    <summary> Поставленная задача... </summary>

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. 
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.

</details>

<details>
    <summary> Решение...  </summary>

Для выполнения приведенных выше требований, на мой взгляд наиболее целесообразно использовать инструменты и сервисы, предоставляемые GitLab CI/CD, являющейся частью GitLab - облачной системы управления исходным кодом и CI/CD. Это инструмент, который позволяет автоматизировать процессы разработки, тестирования и развертывания.

Обоснование выбора GitLab CI/CD :

- Все необходимые компоненты в едином инструментарии.

- GitLab CI/CD встроен в GitLab: GitLab CI/CD является встроенным в GitLab, что обеспечивает единое хранилище для кода, CI/CD и управления задачами. Это позволяет упростить конфигурацию и взаимодействие между компонентами проекта.

- Поддержка Git и множество репозиториев: GitLab поддерживает систему контроля версий Git и позволяет создавать неограниченное количество репозиториев, что соответствует требованию иметь репозиторий для каждого сервиса.

- Автоматические сборки и тестирование: GitLab CI/CD позволяет настроить автоматические сборки для каждого изменения в репозитории (CI), а также тестирование и развертывание (CD). Сборки могут быть запущены по событию из системы контроля версий (например, новый коммит) или по кнопке с указанием параметров (запуск вручную).

- Конфигурация и настройки сборок: GitLab CI/CD позволяет создавать настраиваемые pipeline для сборок. Вы можете привязывать настройки к каждой сборке и создавать шаблоны для различных конфигураций сборок.

- Безопасное хранение секретных данных: GitLab CI/CD предоставляет возможность хранить секретные данные (пароли, ключи доступа) в зашифрованных переменных среды. Эти переменные могут быть использованы в настройках сборок без их отображения в явном виде.

- Пользовательские и кастомные шаги: GitLab CI/CD позволяет создавать пользовательские шаги для сборок, что позволяет настроить pipeline в соответствии с конкретными потребностями проекта.

- Docker и контейнеры: GitLab CI/CD легко интегрируется с Docker, что позволяет создавать собственные Docker-образы для сборки проектов и их развертывания.

- Развертывание агентов сборки: GitLab CI/CD поддерживает возможность развертывания агентов сборки (runners) на собственных серверах, что обеспечивает более гибкую настройку и управление средой выполнения сборок.

- Параллельные сборки и тестирование: GitLab CI/CD позволяет запускать сборки и тестирование параллельно, что обеспечивает оптимизацию времени выполнения процесса CI/CD.

Таким образом, GitLab CI/CD содержит все необходимые инструменты для обеспечения непрерывной интеграции и непрерывной поставки, а также удовлетворяет требованиям облачной системы, системы контроля версий Git, автоматических сборок, кастомных настроек и безопасного хранения секретных данных.

</details>

---

###### task2
### Решение задачи 2: Логи

<details>
    <summary> Поставленная задача ...  </summary>

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.

</details>

<details>
    <summary> Решение ...  </summary>

Для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре наиболее целесообразно использовать Elastic Stack (ELK Stack), включающий в себя:

- Elasticsearch: Центральное хранилище данных и мощный поисковый и аналитический инструмент. Elasticsearch позволяет хранить и индексировать большие объемы данных и обеспечивает эффективный поиск и фильтрацию логов.

- Logstash: Инструмент для сбора, обработки и отправки логов и других данных в Elasticsearch. Logstash поддерживает сбор логов из различных источников, включая stdout, и обеспечивает структурирование данных перед их отправкой в Elasticsearch.

- Kibana: Веб-интерфейс для визуализации и анализа данных, хранящихся в Elasticsearch. Kibana предоставляет гибкие инструменты для поиска, фильтрации, визуализации и анализа логов. Разработчики могут использовать Kibana для создания пользовательских dashboard и запросов к данным.

Соответствие выбранного решения поставленным требованиям:

- Сбор логов в центральное хранилище: Logstash собирает логи со всех хостов и направляет их в Elasticsearch для хранения и анализа.

- Минимальные требования к приложениям: Сбор логов из stdout поддерживается, что делает его удобным для микросервисов, которые обычно направляют логи в stdout.

- Гарантированная доставка логов: Elasticsearch обеспечивает надежное и устойчивое хранение данных, а Logstash имеет механизмы обработки ошибок и повторной отправки данных для гарантированной доставки логов.

- Поиск и фильтрация по записям логов: Elasticsearch обладает мощным языком запросов, позволяющим проводить сложные поиски и фильтрации по логам.

- Пользовательский интерфейс: Kibana предоставляет графический пользовательский интерфейс для поиска, визуализации и анализа данных. Разработчики могут использовать Kibana для создания пользовательских запросов и dashboards.

- Сохранение и обмен поисками: Kibana позволяет сохранять запросы и визуализации, предоставляя возможность генерировать ссылки на сохраненные поиски и dashboards.

- Elastic Stack обеспечивает полный набор инструментов для сбора, хранения, анализа и визуализации логов в микросервисной архитектуре. Его гибкость и расширяемость делают его отличным выбором для проектов различного масштаба и сложности.


</details>

---

###### task3
### Решение задачи 3: Мониторинг

<details>
    <summary> Поставленная задача ...  </summary>

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.

</details>

<details>
    <summary> Решение ...  </summary>

На мой взгляд заявленным требованиям лучше всего соответствует стек `node_exporter + prometheus + grafana`. 
- node_exporter - легковесный агент для сборки метрик с хост-машин и их промежуточного хранения до отправки в систему мониторинга prometheus;


- Prometheus - ядро системы мониторинга. Получает метрики от экспортеров (node_exporter) и сохраняет их в БД временных рядов.

  Поддерживает мощный язык запросов PromQL (Prometheus Query Language) для выборки и агрегации метрик. 

  Prometheus может собирать метрики о ресурсах хостов (CPU, RAM, HDD, Network) и сервисов, что обеспечивает полное представление о состоянии системы.

  Позволяет формировать правила уведомлений (alerts) на основе выражений PromQL для отправки через Alertmanager.

  Prometheus легко расширяем и позволяет разработчикам определять свои собственные метрики для каждого сервиса в зависимости от их уникальных требований.

  Prometheus предоставляет простой веб-интерфейс для запросов к данным и мониторинга состояния системы.

 
- Grafana является одной из самых популярных в мире технологией визуализации, используемой для создания панелей мониторинга. 

  Поддерживает множество источников данных (в том числе prometheus), имеет встроенный функционал оповещений (алёртинга) на пороговые события временных рядов.
  
  Grafana обладает интерактивным пользовательским интерфейсом, который позволяет делать сложные запросы к данным и агрегировать информацию для создания информативных дашбордов.

  Разработчики могут создавать различные панели на дашбордах, настраивая их для отслеживания состояния системы, включая метрики ресурсов и специфичные метрики каждого сервиса.

Решение на основе стека `node_exporter + prometheus + grafana` позволит легко настраивать сбор и визуализацию метрик, обеспечивая полный контроль над состоянием хостов и сервисов в микросервисной архитектуре. 

Также немаловажным является то, что Prometheus и Grafana являются популярными и широко используемыми инструментами в сообществе DevOps и разработки. Это обеспечивает качественную поддержку и множество дополнительных ресурсов для обучения и расширения функциональности.


</details>


---

###### student
### Исполнитель

Сергей Жуков DevOps-32

---